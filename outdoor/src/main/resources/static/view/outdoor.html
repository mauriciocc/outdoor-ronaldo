<section id="panels" class="fundo" onclick="clearInterval(intervalId);loadPage('/view/manage/panels.html')">
    <section id="title"></section>

    <section id="image-container">
        <img id="image" src="">
    </section>

    <section id="footer"></section>
</section>

<section id="messages" class="relogio" onclick="clearInterval(intervalId);loadPage('/view/manage/messages.html')">

</section>
<script type="text/javascript">
    var rotators = [];

    var $msgs = $('#messages');

    function readLM35() {
        var def = $.Deferred();
        def.resolve(25);
        return def.promise();
    }
    $.getJSON('/api/outdoor/messages').then(function (data) {

        var messages = data.map(function (msg) {
            if(msg.content === 'date') {
                return Message(msg.timeOnScreen, false, function () {
                    $msgs.html(createDate());
                })
            }
            if(msg.content === 'time') {
                return Message(msg.timeOnScreen, true, function () {
                    $msgs.html(createTime());
                });
            }
            if(msg.content === 'lm35') {
                return Message(msg.timeOnScreen, false, function () {
                    readLM35().then(function (data) {
                        $msgs.html(data+"ÂºC");
                    });
                });
            }
            return Message(msg.timeOnScreen, false, function (tick) {
                var marq = $('<marquee scrollamount="20" loop="1">'+msg.content+'</marquee>')
                    .on('finish', function () {
                    console.log('asdasdas');
                });
                $msgs.html(marq);

                /*if(msg.timeOnScreen == tick) {

                } else if(tick <= 5) {
                    $msgs.html(msg.content);
                }*/
            })
        });

        rotators.push(new MessageRotator(messages));
    });


    //------------------------------------------------
    var $panels = $('#panels');
    $.getJSON('/api/manage/panels').then(function (data) {
        var panels = data.map(function (msg) {
            return Message(msg.timeOnScreen, false, function () {
                $panels.find('#title').html('<p style="font-size: '+msg.titleStyle.size+'px; color: '+msg.titleStyle.color+';">'+msg.title+'</p>');
                $panels.find('#image').attr('src',msg.image.content);
                $panels.find('#footer').html('<p style="font-size: '+msg.messageStyle.size+'px; color: '+msg.messageStyle.color+';">'+msg.message+'</p>');
            })
        });
        rotators.push(new MessageRotator(panels));
    });

    var intervalId = setInterval(function () {
        rotators.forEach(function (r) {
            r.tick();
        });
        console.log('tick');
    }, 1000);

    $(window).on('resize', function () {
        ajustHeight($panels, $msgs);
    }).trigger('resize').on('keydown', function (e) {
        if(e.which === 32) {
            rotators.forEach(function (r) {
                r.togglePause();
            })
        }
    });


</script>
